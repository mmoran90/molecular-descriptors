---
title: "Cleaning and Classifications"
author: "Madeline Chang"
date: "5/29/2024"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r, message = FALSE}
library(AppliedPredictiveModeling)
library(e1071)
library(caret)
library(rpart)
library(rpart.plot)
library(partykit)
library(earth)
library(kernlab)
library(mlbench)
library(randomForest)
library(dplyr)
library(corrplot)
library(pROC)
library(RANN)
library(glmnet)
```

```{r}
changer_data<- read.csv('/Users/mtc/ADS/ADS 503/Project/period+changer-2/data.csv', header = TRUE) %>%
  mutate(Class = as.factor(Class))
```

```{r}
degen<- nearZeroVar(changer_data)
changer_new<- changer_data[,-degen]

corr<- cor(changer_new[,1:1094])
high_corr <- findCorrelation(corr, cutoff = 0.75)
changer_new<- changer_new[,-high_corr]

skewed<- length(216)
for(i in 1:216){
  skewed[i]<- skewness(changer_new[,i], na.rm = TRUE, type = 1)
}

boxplot(skewed)
```

```{r}
changer_new %>%
  group_by(Class) %>%
  summarise(n = n())
```

```{r}
set.seed(720)

trainingRows <- createDataPartition(changer_new$Class, p = .5, list = FALSE) 
train <- changer_new[trainingRows, ]
test <- changer_new[-trainingRows, ]

ctrl <- trainControl(method = "cv",
                     summaryFunction = twoClassSummary,
                     classProbs = TRUE,
                     savePredictions = TRUE)
```


```{r}
class_function<- function(method){
  model<- train(x = train[,1:216], 
               y = train$Class,
               method = method,
               preProc = c("center", "scale"),
               metric = "ROC",
               trControl = ctrl)
}

class_grid<- function(method, grid){
  model<- train(x = train[,1:216], 
               y = train$Class,
               method = method,
               preProc = c("center", "scale"),
               tuneGrid = grid,
               metric = "ROC",
               trControl = ctrl)
}

class_nnet<- function(method, grid, maxit){
  model<- train(x = train[,1:216], 
               y = train$Class,
               method = method,
               preProc = c("center", "scale"),
               tuneGrid = grid,
               maxit = maxit,
               trace = FALSE, 
               metric = "ROC",
               trControl = ctrl)
}


class_length<- function(method, length){
  model<- train(x = train[,1:216], 
               y = train$Class,
               method = method,
               preProc = c("center", "scale"),
               tuneLength = length,
               metric = "ROC",
               trControl = ctrl)
}

class_bag<- function(method, nbagg){
  model<- train(x = train[,1:216], 
               y = train$Class,
               method = method,
               preProc = c("center", "scale"),
               nbagg = nbagg,
               metric = "ROC",
               trControl = ctrl)
}

class_rf<- function(method, grid, ntree){
  model<- train(x = train[,1:216], 
               y = train$Class,
               method = method,
               preProc = c("center", "scale"),
               tuneGrid = grid,
               ntree = ntree,
               metric = "ROC",
               trControl = ctrl)
}

```

```{r}
set.seed(720)

glmnGrid <- expand.grid(alpha = c(0,  .1,  .2, .4, .6, .8, 1),
                        lambda = seq(.01, .2, length = 10))

nsc_grid<- data.frame(threshold = seq(0, 25, length = 30))

# mda_grid<- data.frame(subclasses=1)

nnet_grid <- expand.grid(size=1:4, decay=c(0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4))

sigmaEst <- kernlab::sigest(as.matrix(train[,1:216]))
svmgrid <- expand.grid(sigma = sigmaEst, C = 2^seq(-4,+4))

mtryValues <- data.frame(mtry = seq(1,10,1))

lr<- class_function("glm")
lda<- class_function("lda")

glmn<- class_grid("glmnet", glmnGrid)
nsc<- class_grid("pam", nsc_grid)
# mda<- class_grid("mda", mda_grid)
svmR<- class_grid("svmRadial", svmgrid)

nnet<- class_nnet("nnet", nnet_grid, 100)

knn<- class_length("knn", 20)

bag<- class_bag("treebag", 50)

rf<- class_rf("rf", mtryValues, 100)
```

```{r}
model_roc <- function(model){
  roc(response = model$pred$obs,
             predictor = model$pred$Changer,
             levels = rev(levels(model$pred$obs)))
}

model_roc(lr)
model_roc(lda)
model_roc(glmn)
model_roc(nsc)
model_roc(svmR)
model_roc(knn)
model_roc(bag)
model_roc(rf)


train_re<- resamples(list(
  lr = lr,
  lda = lda,
  glmn = glmn,
  nsc = nsc,
  svmR = svmR,
  knn = knn,
  bag = bag,
  rf = rf
))

dotplot(train_re, metric = "ROC")
```




